function fx=plot_delay_core_test_real(n0,n1,n2,n3,r0,r1,r2,r3,delay)
n=reshape([n0,n1,n2,n3].',1,[]);
r=reshape([r0,r1,r2,r3].',1,[]);
nn=n([1:2^16]+120+delay);
rr=r([1:2^16]+120);
nn256=reshape(nn,256,[]);
rr256=reshape(rr,256,[]);
fx256=fxcorr(nn256,rr256);
fx=fx256(1:128);
ph=angle(fx);
subplot(2,1,1);
plot(angle(fx)*180/pi,'-o');
xlim([0, 128]);
set(gca,'xtick',[0:16:128]);
ylim([-180, 180]);
set(gca,'ytick',[-180:45:180]);
grid on;
subplot(2,1,2);
plot(abs(fx),'-o');
xlim([0, 128]);
set(gca,'xtick',[0:16:128]);
k=[33:97];
pp=polyfit(k-65,ph(k)',1);
delay=-pp(1)*128/pi;
delay16=round(delay*16);
delayi=floor(delay16/16);
delayf=mod(delay16,16);
delayr=delay-delay16/16;
fprintf(1, 'Phase slope fit = %f samples (%d+%d/16, %+.2f/16)\n', delay, delayi, delayf, delayr);
fprintf(1, 'Phase at center = %f degrees\n', ph(65)*180/pi);