function fx=plot_delay_core_test_rvc(n0,n1,n2,n3,z0,z2,extra_latency)
n=reshape([n0,n1,n2,n3].',1,[]);
z=reshape([z0,z2].',1,[]);
nn=n([1:2^16]+120-extra_latency);
zz=z([1:2^15]+120);
nn256=reshape(nn,256,[]);
zz128=reshape(zz,128,[]);
fn=fft(nn256);
fn128=fn(1:128,:);
fz=fft(zz128);
fz128=circshift(fz,64);
fx=sum(conj(fn128).*fz128,2);
ph=angle(fx);
subplot(2,1,1);
plot(angle(fx)*180/pi,'-o');
xlim([0, 128]);
set(gca,'xtick',[0:16:128]);
ylim([-180, 180]);
set(gca,'ytick',[-180:45:180]);
grid on;
subplot(2,1,2);
plot(abs(fx),'-o');
xlim([0, 128]);
set(gca,'xtick',[0:16:128]);
k=[33:97];
pp=polyfit(k-65,ph(k)',1);
delay=-pp(1)*128/pi;
delay16=round(delay*16);
delayi=floor(delay16/16);
delayf=mod(delay16,16);
delayr=delay-delay16/16;
fprintf(1, 'Phase slope fit = %f samples (%d+%d/16, %+.2f/16)\n', delay, delayi, delayf, delayr);
fprintf(1, 'Phase at center = %f degrees\n', ph(65)*180/pi);